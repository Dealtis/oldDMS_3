<!DOCTYPE html>
<html ng-app="DMSApp" ng-controller="AppCtrl">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <title>Client DMS</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" media="screen" title="no title" charset="utf-8">
    </head>
    <body>
        <section class="container">
            <div class="sendMsg" ng-controller="msgController">
                <h2>Send Msg</h2>
                <div class="input-group my-group">
                    <input type="text" class="form-control" name="snpid" placeholder="Votre message" style="width: 80%" ng-model="Message">
                    <select class="selectpicker form-control" data-live-search="true" title="Chauffeur" style="width: 20%" ng-model="Destinataire">
                        <option ng-repeat="user in users track by $index">{{user}}</option>
                    </select>
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="submit" ng-click="sendMsg(Message,Destinataire)">SEND</button>
                    </span>
                </div>
                <ul class="list">
                    <li ng-repeat="user in users track by $index">{{user}}</li>
                </ul>
            </div>
        </section>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/lodash/4.12.0/lodash.min.js" charset="utf-8"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js" charset="utf-8"></script>
        <script src="bower_components/angular-socket-io/socket.min.js" charset="utf-8"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" charset="utf-8"></script>
        <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
        <script type="text/javascript">
            angular.module('DMSApp', ['btford.socket-io']).factory('WebSocket', function(socketFactory) {
                var myIoSocket = io.connect('http://51.254.101.196:3300/');
                mySocket = socketFactory({ioSocket: myIoSocket});
                return mySocket;
            }).controller('AppCtrl', function($scope, WebSocket) {
                WebSocket.on('OnConn', function() {
                    //WebSocket.emit('OnConnResponse', "Browser")
                    console.log("OnConn");
                })
            }).controller('msgController', function($scope, WebSocket) {
                $scope.users = [];
                $scope.sendMsg = function(Message, Destinataire) {
                    console.log(Message + " / " + Destinataire);
                    WebSocket.emit("newMsg", {
                        Message: Message,
                        Destinataire: Destinataire
                    });
                }
                WebSocket.on("userList", function(users) {
                    console.log(users);
                    $scope.users = [];
                    _.forEach(users, function functionName(user, key) {
                        $scope.users.push(user);
                        console.log(users);
                    })
                });
            });
            //socket.emmit("newPos", position); socket.emmit("clotGrp", clotgrp);
        </script>
    </body>
</html>
